"undefined"==typeof __wm&&(__wm={}),function(){function formatNumber(e){return(""+e).replace(/\B(?=(\d{3})+$)/g,",")}function show_timestamps(){function e(e){var t=Date.parse(e)-c,a="";t<0?(a+="-",t=Math.abs(t)):a+="+";var r=!1;if(t<1e3)return{delta:t,text:"",highlight:r};var n=t,s=Math.floor(t/1e3/60/60/24/30/12);t-=1e3*s*60*60*24*30*12;var o=Math.floor(t/1e3/60/60/24/30);t-=1e3*o*60*60*24*30;var i=Math.floor(t/1e3/60/60/24);t-=1e3*i*60*60*24;var l=Math.floor(t/1e3/60/60);t-=1e3*l*60*60;var p=Math.floor(t/1e3/60);t-=1e3*p*60;var h=Math.floor(t/1e3),d=[];return s>1?(d.push(s+" years"),r=!0):1==s&&(d.push(s+" year"),r=!0),o>1?(d.push(o+" months"),r=!0):1==o&&(d.push(o+" month"),r=!0),i>1?d.push(i+" days"):1==i&&d.push(i+" day"),l>1?d.push(l+" hours"):1==l&&d.push(l+" hour"),p>1?d.push(p+" minutes"):1==p&&d.push(p+" minute"),h>1?d.push(h+" seconds"):1==h&&d.push(h+" second"),d.length>2&&(d=d.slice(0,2)),{delta:n,text:a+d.join(" "),highlight:r}}function t(e,a){for(var r=a.split("/").splice(6).join("/"),n=e.document.querySelectorAll("img[src$='"+r+"'], iframe[src$='"+r+"'], frame[src$='"+r+"']"),s=Array.prototype.slice.call(n),o=0;o<e.frames.length;o++)try{var i=t(e.frames[o].window,a);s=s.concat(i)}catch(e){}return s}function a(e){return"FRAME"==e.tagName||"IFRAME"==e.tagName?e.contentWindow.document.documentElement:e}function r(e){var r=t(window,e.target.href);if(r.length>0)for(var n=0;n<r.length;n++)a(r[n]).classList.add("wb-highlight")}function n(e){var r=t(window,e.target.href);if(r.length>0)for(var n=0;n<r.length;n++)a(r[n]).classList.remove("wb-highlight")}function s(e,t){for(var a=e.document.getElementsByTagName(t),r=Array.prototype.slice.call(a),n=0;n<e.frames.length;n++)try{var o=s(e.frames[n].window,t);r=r.concat(o)}catch(e){}return r}var o=$("wm-capresources");o.innerHTML="";var i=$("wm-capresources-loading");i.style.display="block";for(var l=document.getElementById("wmtb").elements.date.value,c=__wbTs.timestamp2datetime(l).getTime(),p=window.location.origin+"/static/",h=[],d=s(window,"img"),m=0,u=d.length;m<u;m++)d[m].src&&!d[m].src.startsWith(p)&&d[m].src.startsWith(window.location.origin)&&!d[m].src.startsWith("data:")&&h.push(d[m].src);var f=s(window,"frame");for(m=0,u=f.length;m<u;m++)f[m].src&&h.push(f[m].src);var g=s(window,"iframe");for(m=0,u=g.length;m<u;m++)!g[m].src||g[m].id&&"playback"===g[m].id||h.push(g[m].src);var w=s(window,"script");for(m=0,u=w.length;m<u;m++)w[m].src&&!w[m].src.startsWith(p)&&w[m].src.startsWith(window.location.origin)&&h.push(w[m].src);var v=s(window,"link");for(m=0,u=v.length;m<u;m++)v[m].href&&!v[m].href.startsWith(p)&&v[m].href.startsWith(window.location.origin)&&v[m].rel&&"stylesheet"==v[m].rel&&h.push(v[m].href);var y=h.filter(function(e,t,a){return a.indexOf(e)===t});y.length>0?y.map(function(t){ajax("HEAD",t,function(t){if(200==t.status){i.style.display="none";var a=t.getResponseHeader("Memento-Datetime"),s=document.createElement("span"),l=e(a),c=l.highlight?"color:red;":"";s.innerHTML=" "+l.text,s.title=a,s.setAttribute("style",c);var p=t.getResponseHeader("Content-Type"),h=t.responseURL.replace(window.location.origin,""),d=document.createElement("a");d.innerHTML=h.split("/").splice(3).join("/"),d.href=h,d.title=p,d.onmouseover=r,d.onmouseout=n;var m=document.createElement("div");m.setAttribute("data-delta",l.delta),m.appendChild(d),m.append(s),o.appendChild(m);var u=Array.prototype.slice.call(o.childNodes,0);u.sort(function(e,t){return t.getAttribute("data-delta")-e.getAttribute("data-delta")}),o.innerHTML="";for(var f=0,g=u.length;f<g;f++)o.appendChild(u[f])}})}):o.innerHTML="There are no sub-resources in the page."}function isArray(e){return void 0!==e&&e&&e.constructor===Array}function setDisplayStyle(e,t){var a=$(e);a&&(a.style.display=t)}function show(e){isArray(e)||(e=[e]);for(var t=0;t<e.length;t++)setDisplayStyle(e[t],"inline-block")}function hide(e){isArray(e)||(e=[e]);for(var t=0;t<e.length;t++)setDisplayStyle(e[t],"none")}function userIsLoggedIn(){show("wm-save-snapshot-open"),hide("wm-sign-in")}function userIsNotLoggedIn(){hide(["wm-save-snapshot-open","wm-save-snapshot-in-progress"]),show("wm-sign-in")}function startSnapShotSaving(){hide(["wm-save-snapshot-fail","wm-save-snapshot-open","wm-save-snapshot-success"]),show(["wm-save-snapshot-in-progress"])}function successSnapshotSaving(){hide(["wm-save-snapshot-fail","wm-save-snapshot-in-progress"]),show(["wm-save-snapshot-open","wm-save-snapshot-success"])}function failSnapshotSaving(e){hide(["wm-save-snapshot-in-progress","wm-save-snapshot-success"]),show(["wm-save-snapshot-fail","wm-save-snapshot-open"])}function hasCookie(e){return document.cookie.search(e)>=0}var prettyMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],$D=document,$=function(e){return document.getElementById(e)},ajax=__wm.ajax=function(e,t,a,r,n){var s;if(s=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),s.onreadystatechange=function(){4==this.readyState&&a(s)},s.open(e,t,!0),r)for(var o in r)r.hasOwnProperty(o)&&s.setRequestHeader(o,r[o]);s.withCredentials=!0,s.send(n)};__wm.h=function(e){$("wm-ipp").style.display="none",e.stopPropagation()};var $expand,$capinfo;__wm.bt=function bootstrap(imgWidth,imgHeight,yearImgWidth,monthImgWidth,coll,wbCurrentUrl,captureDate,firstYear){function showTrackers(e){var t="mouseenter"==e.type?1:0;if(t!==trackerVal){var a=$("wm-ipp"),r=$("displayYearEl"),n=$("displayMonthEl"),s=$("displayDayEl");t?a.className="hi":(a.className="",r.innerHTML=displayYear,n.innerHTML=prettyMonths[displayMonth-1],s.innerHTML=displayDay),yearTracker.style.display=t?"inline":"none",monthTracker.style.display=t?"inline":"none",trackerVal=t}}function getElementX2(e){var t=$D.documentElement;return("undefied"!=typeof e.getBoundingClientRect?e.getBoundingClientRect():{top:0,left:0}).left+(window.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}function navCaptures(e){for(var t=$("wm-nav-captures"),a=0,r=e.years,n=e.first_ts,s=e.last_ts,o=0;o<r.length;o++)for(var i=r[o][1],l=0;l<i.length;l++)a+=i[l];var c='<a class="t" href="'+wbPrefix+"*/"+wbCurrentUrl+'" title="See a list of every capture for this URL">'+formatNumber(a)+" "+(a>1?"captures":"capture")+"</a>",p=__wbTs.format(n,"%d %b %Y");s!=n&&(p+=" - "+__wbTs.format(s,"%d %b %Y")),c+='<div class="r" title="Timespan for captures of this URL">'+p+"</div>",t.innerHTML=c}function trackMouseMove(e){var t=$spk,a=getEventX(e),r=getElementX2(t),n=Math.min(Math.max(0,a-r),imgWidth),s=n%yearImgWidth,o=Math.floor(n/yearImgWidth),i=Math.min(11,Math.floor(s/monthImgWidth)),l=12*o+i,c=s%2==1?15:1,p=zeroPad(o+firstYear)+zeroPad(i+1,2)+zeroPad(c,2)+"000000";$("displayYearEl").innerHTML=o+firstYear,$("displayMonthEl").innerHTML=prettyMonths[i];var h=wbPrefix+p+"/"+wbCurrentUrl;if($("wm-graph-anchor").href=h,curYear!=o){var d=o*yearImgWidth;yearTracker.style.left=d+"px",curYear=o}if(curMonth!=l){var m=o+l*monthImgWidth+1;monthTracker.style.left=m+"px",curMonth=l}}function disclaimElement(e){window.top==window.self&&(e.style.display="block",$D.body.insertBefore(e,$D.body.firstChild))}function process_autocomplete(e){for(var t=[],a=e.length,r=0;r<a;r++)void 0===e[r].excluded&&t.push(e[r].display_name);return t}var wbPrefix="/"+(coll||"web")+"/";captureDate=captureDate.split("-");var displayDay=captureDate[2],displayMonth=captureDate[1],displayYear=captureDate[0],trackerVal,curYear=-1,curMonth=-1,yearTracker,monthTracker,$spk=$("wm-ipp-sparkline");with($expand=$("wm-expand"),$capinfo=$("wm-capinfo"),yearTracker=$D.createElement("div"),yearTracker.className="yt",yearTracker.style)display="none",width=yearImgWidth+"px",height=imgHeight+"px";with(monthTracker=$D.createElement("div"),monthTracker.className="mt",monthTracker.style)display="none",width=monthImgWidth+"px",height=imgHeight+"px";$spk.appendChild(yearTracker),$spk.appendChild(monthTracker);var $cv=$("wm-sparkline-canvas");$spk.onmouseenter=showTrackers,$spk.onmouseleave=showTrackers,$spk.onmousemove=function(e){var t=$spk,a=getEventX(e),r=getElementX2(t),n=Math.min(Math.max(0,a-r),imgWidth),s=n%yearImgWidth,o=Math.floor(n/yearImgWidth),i=Math.min(11,Math.floor(s/monthImgWidth)),l=12*o+i,c=s%2==1?15:1,p=zeroPad(o+firstYear)+zeroPad(i+1,2)+zeroPad(c,2)+"000000";$("displayYearEl").innerHTML=o+firstYear,$("displayMonthEl").innerHTML=prettyMonths[i];var h=wbPrefix+p+"/"+wbCurrentUrl;if($("wm-graph-anchor").href=h,curYear!=o){var d=o*yearImgWidth;yearTracker.style.left=d+"px",curYear=o}if(curMonth!=l){var m=o+l*monthImgWidth+1;monthTracker.style.left=m+"px",curMonth=l}};var $ipp=$("wm-ipp");$ipp&&function(e){window.top==window.self&&(e.style.display="block",$D.body.insertBefore(e,$D.body.firstChild))}($ipp);var testCanvas=document.createElement("canvas");if(testCanvas.getContext&&testCanvas.getContext("2d")){var sparkline_url="/__wb/sparkline?output=json&url="+encodeURIComponent(wbCurrentUrl)+(coll&&"&collection="+coll||"");ajax("GET",sparkline_url,function(e){if(200==e.status){for(var t=JSON.parse(e.responseText),a=t.years,r=Object.getOwnPropertyNames(a),n=t.years=[],s=0;s<r.length;s++){var o=r[s];a[o]&&n.push([o,a[o]])}navCaptures(t),sparkline(t,imgWidth,imgHeight,"wm-sparkline-canvas",firstYear,displayYear,displayMonth)}})}else{var sparklineImg=new Image;sparklineImg.src="/__wb/sparkline?url="+encodeURIComponent(wbCurrentUrl)+"&width="+imgWidth+"&height="+imgHeight+"&selected_year="+displayYear+"&selected_month="+displayMonth+(coll&&"&collection="+coll||""),sparklineImg.alt="sparkline",sparklineImg.width=imgWidth,sparklineImg.height=imgHeight,sparklineImg.id="sparklineImgId",sparklineImg.border="0",$cv.parentNode.replaceChild(sparklineImg,$cv)}new wbAutoComplete({selector:"input#wmtbURL",delay:400,source:function(e,t){ajax("GET","/__wb/search/host?q="+encodeURIComponent(e),function(a){if(void 0!==(a=JSON.parse(a.response)).hosts&&a.hosts.length>0){var r=process_autocomplete(a.hosts);t(r)}else void 0!==a.isUrl&&!0===a.isUrl&&void 0===a.excluded?t([e]):ajax("GET","/__wb/search/anchor?q="+encodeURIComponent(e),function(e){if(void 0!==(e=JSON.parse(e.response))&&e.length>0){var a=process_autocomplete(e.slice(0,5));t(a)}})})},onSelect:function(e,t,a){$("wmtb").submit()}}),$("wmtb").onsubmit=function(e){var t=$("wmtbURL").value;if(0!==t.indexOf("http://")&&0!==t.indexOf("https://")&&!t.match(/[\w\.]{2,256}\.[a-z]{2,4}/gi))return document.location.href="/web/*/"+$("wmtbURL").value,e.preventDefault(),!1}},__wm.ex=function(e){e.stopPropagation();var t=$expand.className;t.match(/wm-closed/)?($expand.className=t.replace(/wm-closed/,"wm-open"),$capinfo.style.display="block",show_timestamps()):($expand.className=t.replace(/wm-open/,"wm-closed"),$capinfo.style.display="none")},__wm.saveSnapshot=function(e,t,a){return startSnapShotSaving(),ajax("POST","/__wb/web-archive/",function(e){401===e.status?userIsNotLoggedIn():e.status>=400?(failSnapshotSaving(e.responseText),console.log("You have got an error."),console.log("If you think something wrong here please send it to support."),console.log('Response: "'+e.responseText+'"'),console.log('status: "'+e.status+'"')):successSnapshotSaving()},{"Content-Type":"application/json"},JSON.stringify({url:e,snapshot:t,tags:a||[]})),!1},document.addEventListener("DOMContentLoaded",function(){hasCookie("logged-in-user")&&hasCookie("logged-in-sig")?userIsLoggedIn():userIsNotLoggedIn()})}();
//# sourceMappingURL=maps/toolbar.js.map
